<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>
<body>
    <div style="display: flex;">
        <div style="width:24%"></div>
        <img src="anadolubank-logo.png" alt="">
    </div>
    <div>
        <div style="padding:10px;text-align: center;">
                <h3>
                    Dengage - Anadolubank Event Test Page
                </h3>
        </div>
            
        <div style="width:50%;margin: 0 auto;">
            <form action="/action_page.php">
                <div class="form-group">
                    <label for="accountType">Account Type:</label>
                    <select class="form-control" id="accountType" onchange="selectAccountType()">
                        <option>Standart</option>
                        <option>Renkli</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transactionType">Transaction Type:</label>
                    <select class="form-control" id="transactionType" onchange="selectTransactionType()">
                        <option>eft</option>
                        <option>havale</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amount">Amount:</label>
                    <input class="form-control" id="amount" onblur="sendAmount()">
                </div>
                <!--<div style="text-align:right">
                    <div onclick="myFunction()" class="btn btn-info" style="cursor:pointer">Send</div>
                </div>-->
                
            </form>
        </div>
    
        <div style="padding-top: 10px;width: 50%;margin: 0 auto;">
            <div id="msg" class="alert alert-info" style="display: none;"></div>
            <!--<div id="notMsg" class="alert alert-danger" style="display: none;"></div>-->
        </div>
    </div>
    
        
</body>
</html>

<script>
function myFunction() {
    var accountType = document.getElementById("accountType").value;
    var transactionType = document.getElementById("transactionType").value;
    var amount = document.getElementById("amount").value;
    var obje = 
    {
        accountGuid: "02df01fc-d2c6-4f71-324d-3c36f9fee4cc",
        channel: "case1",
        deviceId: "",
        contactKey: 'demo_zvooxbfi',
        extraParams: {
            transaction_type : transactionType,
            account_type: accountType,
            amount: amount
        }
    };
    postData('https://ppcma.dengage.com/api/c/m/search', obje )
        .then(data => {
            console.log(data); // JSON data parsed by `data.json()` call
            
            if (data.length > 0) {
                var message = JSON.parse(data[0].message)
                document.getElementById("notMsg").style.display = "none";
                document.getElementById("msg").style.display = "block";
                document.getElementById("msg").innerHTML = message.message;
            } else {
                document.getElementById("msg").style.display = "none";
                document.getElementById("notMsg").style.display = "block";
                document.getElementById("notMsg").innerHTML = "No message";
            }
        });
}
async function postData(url = '', data = {}) {
  // Default options are marked with *
  const response = await fetch(url, {
    method: 'POST', // *GET, POST, PUT, DELETE, etc.
    mode: 'cors', // no-cors, *cors, same-origin
    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
    credentials: 'same-origin', // include, *same-origin, omit
    headers: {
      'Content-Type': 'application/json'
      // 'Content-Type': 'application/x-www-form-urlencoded',
    },
    redirect: 'follow', // manual, *follow, error
    referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
    body: JSON.stringify(data) // body data type must match "Content-Type" header
  });
  try {
    return await response.json(); // parses JSON response into native JavaScript objects
  } catch (error) {
    return [];
  }
   
}

function selectAccountType() {
    var accountType = document.getElementById("accountType").value;
    var transactionType = document.getElementById("transactionType").value;
    var amount = document.getElementById("amount").value;
    var obje = 
    {
        accountGuid: "02df01fc-d2c6-4f71-324d-3c36f9fee4cc",
        channel: "case1",
        deviceId: "",
        contactKey: 'demo_zvooxbfi',
        extraParams: {
            transaction_type : transactionType,
            account_type: accountType,
            amount: amount
        }
    };
    if (amount) {
        postData('https://ppcma.dengage.com/api/c/m/search', obje )
            .then(data => {
                console.log(data); // JSON data parsed by `data.json()` call
                
                if (data.length > 0) {
                    var message = JSON.parse(data[0].message)
                    //document.getElementById("notMsg").style.display = "none";
                    document.getElementById("msg").style.display = "block";
                    document.getElementById("msg").innerHTML = message.message;
                } else {
                    document.getElementById("msg").style.display = "none";
                    //document.getElementById("notMsg").style.display = "block";
                    //document.getElementById("notMsg").innerHTML = "No message";
                }
            });
    }
    
}
function selectTransactionType() {
    var accountType = document.getElementById("accountType").value;
    var transactionType = document.getElementById("transactionType").value;
    var amount = document.getElementById("amount").value;
    var obje = 
    {
        accountGuid: "02df01fc-d2c6-4f71-324d-3c36f9fee4cc",
        channel: "case1",
        deviceId: "",
        contactKey: 'demo_zvooxbfi',
        extraParams: {
            transaction_type : transactionType,
            account_type: accountType,
            amount: amount
        }
    };
    if (amount) {
        postData('https://ppcma.dengage.com/api/c/m/search', obje )
            .then(data => {
                console.log(data); // JSON data parsed by `data.json()` call
                
                if (data.length > 0) {
                    var message = JSON.parse(data[0].message)
                    //document.getElementById("notMsg").style.display = "none";
                    document.getElementById("msg").style.display = "block";
                    document.getElementById("msg").innerHTML = message.message;
                } else {
                    document.getElementById("msg").style.display = "none";
                    //document.getElementById("notMsg").style.display = "block";
                    //document.getElementById("notMsg").innerHTML = "No message";
                }
            });
    }
    
}
function sendAmount() {
    var accountType = document.getElementById("accountType").value;
    var transactionType = document.getElementById("transactionType").value;
    var amount = document.getElementById("amount").value;
    var obje = 
    {
        accountGuid: "02df01fc-d2c6-4f71-324d-3c36f9fee4cc",
        channel: "case1",
        deviceId: "",
        contactKey: 'demo_zvooxbfi',
        extraParams: {
            transaction_type : transactionType,
            account_type: accountType,
            amount: amount
        }
    };
    if (amount) {
        postData('https://ppcma.dengage.com/api/c/m/search', obje )
            .then(data => {
                console.log(data); // JSON data parsed by `data.json()` call
                
                if (data.length > 0) {
                    var message = JSON.parse(data[0].message)
                    //document.getElementById("notMsg").style.display = "none";
                    document.getElementById("msg").style.display = "block";
                    document.getElementById("msg").innerHTML = message.message;
                } else {
                    document.getElementById("msg").style.display = "none";
                    //document.getElementById("notMsg").style.display = "block";
                    //document.getElementById("notMsg").innerHTML = "No message";
                }
            });
    }
}

</script>